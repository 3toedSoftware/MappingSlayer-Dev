<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SVG Text Wrapping Demo</title>
        <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3plus-text@1"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background: #f0f0f0;
            }

            .container {
                display: flex;
                gap: 20px;
                align-items: flex-start;
            }

            .controls {
                flex: 1;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .sign-preview {
                flex: 1;
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            h1 {
                color: #003875;
                margin-top: 0;
            }

            h2 {
                color: #003875;
                font-size: 1.2em;
                margin-top: 0;
            }

            label {
                display: block;
                margin-bottom: 5px;
                color: #666;
                font-weight: bold;
            }

            input[type='text'],
            textarea {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
                box-sizing: border-box;
            }

            textarea {
                min-height: 100px;
                resize: vertical;
            }

            .input-group {
                margin-bottom: 15px;
            }

            .dimensions {
                display: flex;
                gap: 10px;
            }

            .dimensions .input-group {
                flex: 1;
            }

            input[type='number'] {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                box-sizing: border-box;
            }

            #svg-container {
                border: 1px solid #ddd;
                background: #fafafa;
            }

            .info {
                background: #e3f2fd;
                padding: 10px;
                border-radius: 4px;
                margin-top: 15px;
                font-size: 0.9em;
                color: #1976d2;
            }

            .presets {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }

            .preset-btn {
                padding: 8px 12px;
                background: #003875;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 12px;
            }

            .preset-btn:hover {
                background: #002855;
            }
        </style>
    </head>
    <body>
        <h1>SVG Text Wrapping Demo - Sign Template System</h1>

        <div class="container">
            <div class="controls">
                <h2>Sign Text Input</h2>

                <div class="presets">
                    <button class="preset-btn" onclick="setPreset('STORAGE')">Storage</button>
                    <button class="preset-btn" onclick="setPreset('EMPLOYEES\nONLY')">
                        Employees Only
                    </button>
                    <button
                        class="preset-btn"
                        onclick="setPreset('SURGICAL SERVICES\nCONSULT\nROOM 1')"
                    >
                        Consult Room
                    </button>
                    <button class="preset-btn" onclick="setPreset('AUTHORIZED\nPERSONNEL\nONLY')">
                        Authorized
                    </button>
                </div>

                <div class="input-group">
                    <label for="sign-text">Sign Text:</label>
                    <textarea id="sign-text" placeholder="Enter sign text here...">
STORAGE</textarea
                    >
                </div>

                <div class="dimensions">
                    <div class="input-group">
                        <label for="font-size">Font Size (px):</label>
                        <input type="number" id="font-size" value="38" min="10" max="200" />
                    </div>
                    <div class="input-group">
                        <label for="line-height">Line Height:</label>
                        <input
                            type="number"
                            id="line-height"
                            value="1.2"
                            min="0.8"
                            max="2"
                            step="0.1"
                        />
                    </div>
                </div>

                <div class="dimensions">
                    <div class="input-group">
                        <label for="box-width">Width (px):</label>
                        <input type="number" id="box-width" value="600" min="100" max="800" />
                    </div>
                    <div class="input-group">
                        <label for="box-height">Height (px):</label>
                        <input type="number" id="box-height" value="400" min="100" max="800" />
                    </div>
                </div>

                <div class="info">
                    <strong>Note:</strong> At 100 DPI, 37.5px = 0.375 inches (standard ADA character
                    height)<br />
                    At 72 DPI, 27px = 0.375 inches<br />
                    At 96 DPI (screen), 36px = 0.375 inches<br />
                    Default is 38px (0.38" at 100 DPI - slightly over ADA minimum)
                </div>

                <div class="info" style="background: #fff3cd; color: #856404">
                    <strong>Sign Info:</strong><br />
                    <span id="sign-info">Sign: 800x800px (8" x 8" at 100 DPI)</span><br />
                    <span id="text-info">Text area: calculating...</span>
                </div>
            </div>

            <div class="sign-preview">
                <h2>Sign Preview</h2>
                <div id="svg-container"></div>
                <div class="info" style="margin-top: 10px">
                    Text automatically wraps and centers both horizontally and vertically within the
                    sign area.
                </div>
            </div>
        </div>

        <script>
            // Sign dimensions (8" x 8" at 100 DPI)
            const SIGN_WIDTH = 800; // 8" at 100 DPI
            const SIGN_HEIGHT = 800; // 8" at 100 DPI
            const MARGIN = 100; // 1" margin on each side

            // Create SVG
            const svg = d3
                .select('#svg-container')
                .append('svg')
                .attr('width', SIGN_WIDTH)
                .attr('height', SIGN_HEIGHT)
                .attr('viewBox', `0 0 ${SIGN_WIDTH} ${SIGN_HEIGHT}`);

            // Add background (sign plate)
            svg.append('rect')
                .attr('width', SIGN_WIDTH)
                .attr('height', SIGN_HEIGHT)
                .attr('fill', '#f5f5f5')
                .attr('stroke', '#ccc')
                .attr('stroke-width', 2);

            // Add logo placeholder (orange cross)
            const logoGroup = svg
                .append('g')
                .attr('transform', `translate(${SIGN_WIDTH - 150}, 50)`);

            // Simple cross shape for logo
            logoGroup
                .append('rect')
                .attr('x', 35)
                .attr('y', 0)
                .attr('width', 30)
                .attr('height', 100)
                .attr('fill', '#FF6B35');

            logoGroup
                .append('rect')
                .attr('x', 0)
                .attr('y', 35)
                .attr('width', 100)
                .attr('height', 30)
                .attr('fill', '#FF6B35');

            // Text area visualization (dashed border)
            const textAreaRect = svg
                .append('rect')
                .attr('id', 'text-area')
                .attr('x', MARGIN)
                .attr('y', 200)
                .attr('width', SIGN_WIDTH - MARGIN * 2)
                .attr('height', 400)
                .attr('fill', 'none')
                .attr('stroke', '#003875')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '5,5')
                .attr('opacity', 0.3);

            // Create text container
            const textContainer = svg
                .append('g')
                .attr('id', 'sign-text-container')
                .attr('class', 'text-wrapper');

            // Add measurement rulers
            const rulerGroup = svg.append('g').attr('id', 'rulers');

            // Horizontal ruler (top)
            rulerGroup
                .append('line')
                .attr('x1', 0)
                .attr('y1', 30)
                .attr('x2', SIGN_WIDTH)
                .attr('y2', 30)
                .attr('stroke', '#666')
                .attr('stroke-width', 1);

            rulerGroup
                .append('text')
                .attr('x', SIGN_WIDTH / 2)
                .attr('y', 20)
                .attr('text-anchor', 'middle')
                .attr('font-size', 12)
                .attr('fill', '#666')
                .text('8 inches (800px at 100 DPI)');

            // Vertical ruler (left)
            rulerGroup
                .append('line')
                .attr('x1', 30)
                .attr('y1', 0)
                .attr('x2', 30)
                .attr('y2', SIGN_HEIGHT)
                .attr('stroke', '#666')
                .attr('stroke-width', 1);

            // Function to update text
            function updateText() {
                const text = document.getElementById('sign-text').value;
                const fontSize = parseInt(document.getElementById('font-size').value);
                const lineHeight = parseFloat(document.getElementById('line-height').value);
                const boxWidth = parseInt(document.getElementById('box-width').value);
                const boxHeight = parseInt(document.getElementById('box-height').value);

                // Calculate text area position (centered on sign)
                const textX = (SIGN_WIDTH - boxWidth) / 2;
                const textY = (SIGN_HEIGHT - boxHeight) / 2;

                // Update info display
                const inchWidth = (boxWidth / 100).toFixed(2);
                const inchHeight = (boxHeight / 100).toFixed(2);
                const inchFont = (fontSize / 100).toFixed(3);
                document.getElementById('text-info').textContent =
                    `Text area: ${boxWidth}x${boxHeight}px (${inchWidth}" x ${inchHeight}") | Font: ${fontSize}px (${inchFont}" at 100 DPI)`;

                // Update text area rectangle
                textAreaRect
                    .attr('x', textX)
                    .attr('y', textY)
                    .attr('width', boxWidth)
                    .attr('height', boxHeight);

                // Clear previous text
                textContainer.selectAll('*').remove();

                // Check if d3plus is loaded
                if (typeof d3plus === 'undefined') {
                    console.error('d3plus not loaded!');
                    // Fallback to simple SVG text
                    textContainer
                        .append('text')
                        .attr('x', textX + boxWidth / 2)
                        .attr('y', textY + boxHeight / 2)
                        .attr('text-anchor', 'middle')
                        .attr('dominant-baseline', 'middle')
                        .attr('font-size', fontSize)
                        .attr('font-weight', 'bold')
                        .attr('fill', '#003875')
                        .text(text);
                    return;
                }

                console.log('Rendering text:', text);
                console.log('Settings:', {
                    fontSize: fontSize + 'px (' + (fontSize / 100).toFixed(3) + '" at 100 DPI)',
                    lineHeight: lineHeight,
                    textArea: boxWidth + 'x' + boxHeight + 'px',
                    position: 'x:' + textX + ', y:' + textY
                });

                // Use d3plus TextBox for text wrapping
                try {
                    // Create a new TextBox instance
                    const box = new d3plus.TextBox()
                        .select('#sign-text-container') // Select by ID
                        .data([{ text: text }])
                        .x(textX)
                        .y(textY)
                        .width(boxWidth)
                        .height(boxHeight)
                        .fontSize(fontSize)
                        .fontFamily('Arial, sans-serif')
                        .fontWeight(700)
                        .fontColor('#003875')
                        .textAnchor('middle')
                        .verticalAlign('middle')
                        .lineHeight(lineHeight);

                    // Render the text box
                    box.render();
                } catch (error) {
                    console.error('Error rendering text:', error);
                }
            }

            // Function to set preset text
            function setPreset(text) {
                document.getElementById('sign-text').value = text;
                updateText();
            }

            // Add event listeners
            document.getElementById('sign-text').addEventListener('input', updateText);
            document.getElementById('font-size').addEventListener('input', updateText);
            document.getElementById('line-height').addEventListener('input', updateText);
            document.getElementById('box-width').addEventListener('input', updateText);
            document.getElementById('box-height').addEventListener('input', updateText);

            // Initial render
            updateText();
        </script>
    </body>
</html>
